# TelegramUserBot

## Введение

TelegramUserBot — это Telegram-бот на Java с использованием библиотеки TelegramBots, который:
- Запоминает ID пользователей, пишущих ему, в памяти (HashSet).
- Позволяет владельцу отправлять индивидуальные сообщения пользователям по их ID.
- Позволяет владельцу просматривать и удалять пользователей из списка.

## Состав проекта

### Структура директорий
```
sendBot/
├── pom.xml                          # Конфигурация Maven проекта
├── README.md                        # Документация проекта
├── .gitignore                       # Правила игнорирования файлов для Git
├── src/
│   └── main/
│       ├── java/
│       │   └── com/
│       │       └── example/
│       │           └── TelegramUserBot.java  # Основной класс бота
│       └── resources/
│           └── config.properties    # Конфигурационный файл (токен и ID владельца)
├── target/                          # Скомпилированные файлы (генерируется при сборке)
│   ├── classes/                     # Скомпилированные .class файлы
│   └── *.jar                        # JAR файлы проекта
└── users.json                       # Файл данных пользователей (создается автоматически)
```

### Основные файлы

#### `pom.xml`
- Конфигурация Maven проекта
- Зависимости:
  - `telegrambots` (версия 6.8.0) — библиотека для работы с Telegram Bot API
  - `json` (версия 20231013) — библиотека для работы с JSON
- Настройки компиляции: Java 11
- Плагин `maven-assembly-plugin` для создания JAR с зависимостями

#### `src/main/java/com/example/TelegramUserBot.java`
- Основной класс бота, наследуется от `TelegramLongPollingBot`
- Реализует функциональность:
  - Регистрация пользователей
  - Отправка сообщений пользователям
  - Отправка медиа-файлов (фото, документы)
  - Массовая рассылка сообщений
  - Управление списком пользователей
  - Интерактивные кнопки для владельца и пользователей
  - Сохранение и загрузка данных пользователей в JSON

#### `src/main/resources/config.properties`
- Конфигурационный файл с настройками:
  - `bot.token` — токен бота от BotFather
  - `owner.id` — Telegram ID владельца бота

#### `users.json`
- Автоматически создаваемый файл для хранения данных пользователей
- Формат: JSON с массивом объектов пользователей (ID и имя)
- Создается при первом запуске бота

#### `.gitignore`
- Правила игнорирования файлов для Git
- Игнорирует: `target/`, `.idea/`, `users.json`, `*.properties`, скомпилированные файлы и др.

### Зависимости проекта
- **Java**: версия 11 или выше
- **Maven**: для сборки проекта
- **TelegramBots**: библиотека для работы с Telegram Bot API
- **JSON**: библиотека для работы с JSON форматом

## Регистрация бота
1. Перейдите к [BotFather](https://t.me/BotFather) в Telegram.
2. Создайте нового бота командой `/newbot` и получите токен.
3. Запомните username и токен бота.

## Настройка проекта

### Зависимость Maven
В `pom.xml` уже добавлена зависимость:
```xml
<dependency>
    <groupId>org.telegram</groupId>
    <artifactId>telegrambots</artifactId>
    <version>6.8.0</version>
</dependency>
```

### Структура проекта
- `TelegramUserBot.java` — основной класс бота.
- `config.properties` — файл конфигурации с токеном и ID владельца.
- `pom.xml` — Maven-конфигурация.

### Конфигурация
В файле `config.properties` укажите:
```
bot.token=ВАШ_ТОКЕН_БОТА
owner.id=ВАШ_ID_ВЛАДЕЛЬЦА
```

`owner.id` — это ваш Telegram user ID (можно узнать через @userinfobot).

## Основные классы и методы
- **TelegramUserBot** — наследует `TelegramLongPollingBot`.
  - В памяти хранит `HashSet<Long> userIds`.
  - При получении любого сообщения добавляет ID пользователя в HashSet.
  - Команды для владельца:
    - `/send <user_id> <message>` — отправить сообщение пользователю.
    - `/list` — список всех зарегистрированных ID.
    - `/remove <user_id>` — удалить пользователя из списка.
  - Все команды обрабатываются с проверкой прав владельца и с обработкой ошибок.

## Использование команд
- `/send 123456789 Привет, как дела?` — отправить сообщение пользователю с ID 123456789.
- `/list` — получить список всех зарегистрированных пользователей.
- `/remove 123456789` — удалить пользователя с ID 123456789.

## Развертывание

### Вариант 1: Long Polling
1. Соберите проект: `mvn package`
2. Запустите: `java -cp target/telegram-userbot-1.0-SNAPSHOT.jar TelegramUserBot`

### Вариант 2: Webhook
1. Реализуйте класс, наследующий `TelegramWebhookBot` (см. [документацию TelegramBots](https://github.com/rubenlagus/TelegramBots)).
2. Настройте HTTPS-сервер и зарегистрируйте webhook через `setWebhook`.
3. Укажите публичный URL в настройках бота.

## Ограничения
- Все данные (userIds) хранятся только в памяти и теряются при перезапуске бота.

## Тестирование
1. Создайте несколько тестовых Telegram-аккаунтов.
2. Отправьте сообщения боту с разных аккаунтов — они будут зарегистрированы.
3. Используйте `/list` для проверки списка ID.
4. Используйте `/send <user_id> <message>` для отправки сообщений.
5. Используйте `/remove <user_id>` для удаления пользователя.
6. Проверьте обработку ошибок:
   - Неверный формат команды (например, `/send` без аргументов).
   - Попытка отправить сообщение несуществующему пользователю. 
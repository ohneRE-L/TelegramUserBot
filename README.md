# TelegramUserBot

## Введение

TelegramUserBot — это полнофункциональный Telegram-бот на Java с использованием библиотеки TelegramBots, который:
- Запоминает ID пользователей, пишущих ему, с сохранением в файл `users.json`.
- Позволяет пользователям устанавливать имена через команду `/name`.
- Позволяет владельцу отправлять индивидуальные и массовые сообщения пользователям.
- Поддерживает отправку медиафайлов (фото, документы) как индивидуально, так и массово.
- Пересылает все сообщения от пользователей владельцу бота.
- Поддерживает пакетную отправку сообщений из файла.

## Регистрация бота
1. Перейдите к [BotFather](https://t.me/BotFather) в Telegram.
2. Создайте нового бота командой `/newbot` и получите токен.
3. Запомните username и токен бота.

## Настройка проекта

### Зависимость Maven
В `pom.xml` уже добавлена зависимость:
```xml
<dependency>
    <groupId>org.telegram</groupId>
    <artifactId>telegrambots</artifactId>
    <version>6.8.0</version>
</dependency>
```

### Структура проекта
- `TelegramUserBot.java` — основной класс бота.
- `config.properties` — файл конфигурации с токеном и ID владельца.
- `users.json` — файл для хранения пользователей и их имен.
- `pom.xml` — Maven-конфигурация.

### Конфигурация
В файле `config.properties` укажите:
```
bot.token=ВАШ_ТОКЕН_БОТА
owner.id=ВАШ_ID_ВЛАДЕЛЬЦА
```

`owner.id` — это ваш Telegram user ID (можно узнать через @userinfobot).

## Команды для пользователей
- `/start` — приветствие и отображение клавиатуры.
- `/name <имя>` — установить или изменить свое имя.
- `/help` — показать список доступных команд.
- **Кнопки клавиатуры:**
  - "Помощь" — показать справку.
  - "Указать имя" — подсказка по установке имени.
  - "Моё имя" — показать текущее имя.

## Команды для владельца
- `/send <user_id> <сообщение>` — отправить сообщение конкретному пользователю.
- `/sendall <сообщение>` — отправить сообщение всем пользователям.
- `/list` — показать список всех пользователей с именами и ID.
- `/remove <user_id>` — удалить пользователя из списка.
- `/sendbatch` — отправить сообщения из файла (файл должен быть прикреплен).
- `/sendmedia <user_id>` — отправить фото или документ пользователю (следующим сообщением).
- `/sendmediaall` — отправить фото или документ всем пользователям (следующим сообщением).
- `/help` — показать справку для владельца.

## Примеры использования команд

### Для пользователей:
- `/name Иван Петров` — установить имя "Иван Петров".
- Нажать кнопку "Моё имя" — посмотреть текущее имя.

### Для владельца:
- `/send 123456789 Привет, как дела?` — отправить сообщение пользователю с ID 123456789.
- `/sendall Важное объявление для всех!` — отправить сообщение всем пользователям.
- `/list` — получить список всех зарегистрированных пользователей с именами.
- `/remove 123456789` — удалить пользователя с ID 123456789.
- `/sendmedia 123456789` — затем отправить фото/документ для пересылки пользователю.
- `/sendmediaall` — затем отправить фото/документ для рассылки всем.

### Пакетная отправка:
1. Создайте текстовый файл с парами `<user_id> <сообщение>` (по одной паре на строку).
2. Отправьте команду `/sendbatch`.
3. Прикрепите созданный файл к следующему сообщению.

## Развертывание

### Вариант 1: Long Polling
1. Соберите проект: `mvn package`
2. Запустите: `java -cp target/telegram-userbot-1.0-SNAPSHOT.jar TelegramUserBot`

### Вариант 2: Webhook
1. Реализуйте класс, наследующий `TelegramWebhookBot` (см. [документацию TelegramBots](https://github.com/rubenlagus/TelegramBots)).
2. Настройте HTTPS-сервер и зарегистрируйте webhook через `setWebhook`.
3. Укажите публичный URL в настройках бота.

## Особенности
- **Сохранение данных**: Пользователи и их имена сохраняются в файл `users.json` и восстанавливаются при перезапуске.
- **Пересылка сообщений**: Все сообщения от пользователей (текст, фото, документы, видео, аудио, голосовые, стикеры) пересылаются владельцу.
- **Интерактивная клавиатура**: Пользователи получают удобную клавиатуру с кнопками для основных действий.
- **Обработка ошибок**: Все команды обрабатываются с проверкой прав и обработкой ошибок.
- **Массовые рассылки**: Поддержка отправки сообщений и медиа всем пользователям одновременно.

## Тестирование
1. **Регистрация пользователей**: Создайте несколько тестовых Telegram-аккаунтов и отправьте `/start` боту.
2. **Установка имен**: Используйте `/name <имя>` для установки имен пользователей.
3. **Проверка списка**: Используйте `/list` для просмотра всех зарегистрированных пользователей.
4. **Индивидуальная отправка**: Используйте `/send <user_id> <сообщение>` для отправки сообщений.
5. **Массовая рассылка**: Используйте `/sendall <сообщение>` для отправки всем пользователям.
6. **Отправка медиа**: Используйте `/sendmedia <user_id>` и `/sendmediaall` для отправки фото/документов.
7. **Пакетная отправка**: Создайте файл с парами `<user_id> <сообщение>` и используйте `/sendbatch`.
8. **Пересылка сообщений**: Отправьте различные типы сообщений (текст, фото, документы) от пользователей — они должны пересылаться владельцу.
9. **Проверка обработки ошибок**:
   - Неверный формат команды (например, `/send` без аргументов).
   - Попытка отправить сообщение несуществующему пользователю.
   - Отправка медиа без предварительной команды. 